<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ç¾Šäº†ä¸ªç¾Š Â· PC+æ‰‹æœºé€‚é…ç‰ˆ</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <style>
    body { background:#222; color:#fff; font-family:sans-serif; text-align:center; margin:0; }
    #board {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      grid-template-rows: repeat(6, 1fr);
      width: 95vw;
      max-width: 640px;
      height: 70vh;
      margin: 10px auto;
      background: #333;
      border-radius: 12px;
      position: relative;
    }
    .tile {
      display:flex; align-items:center; justify-content:center;
      font-size: clamp(24px, 5vw, 48px); /* ä¿®æ”¹åçš„è‡ªé€‚åº”å¤§å° */
      background:#444; border-radius:8px;
      transition: transform .1s;
    }
    .tile.disabled { filter:brightness(0.6); cursor:not-allowed; }
    .layer0 { z-index:0; box-shadow:inset 0 0 6px #000; }
    .layer1 { z-index:1; transform: translate(6px,6px); box-shadow:0 2px 6px rgba(0,0,0,0.4); }
    .layer2 { z-index:2; transform: translate(12px,12px); box-shadow:0 4px 10px rgba(0,0,0,0.6); }
    .layer3 { z-index:3; transform: translate(18px,18px); box-shadow:0 6px 14px rgba(0,0,0,0.8); }
    #slot { margin:10px auto; display:flex; justify-content:center; gap:6px; flex-wrap:wrap; max-width:95vw; }
    .slot-cell {
      border:2px dashed #777; border-radius:8px;
      display:flex; align-items:center; justify-content:center;
      color:#fff;
      width: clamp(48px, 10vw, 64px);   /* è‡ªé€‚åº”å®½åº¦ */
      height: clamp(48px, 10vw, 64px);  /* è‡ªé€‚åº”é«˜åº¦ */
      font-size: clamp(20px, 5vw, 32px); /* è‡ªé€‚åº”å­—ä½“å¤§å° */
    }
    .controls { margin:10px; }
    button {
      margin:0 5px; padding:6px 12px;
      border-radius:6px; border:none; cursor:pointer;
      font-size: clamp(20px, 4vw, 32px); /* æ–°å¢ï¼šè‡ªé€‚åº”å­—å· */
    }
    button:hover { background:#444; }
    h2 {
      font-size: clamp(24px, 6vw, 36px); /* è‡ªé€‚åº”æ ‡é¢˜å¤§å° */
      margin: 12px 0;
    }
    h3 {
      font-size: clamp(20px, 4vw, 32px); /* è‡ªé€‚åº”æ ‡é¢˜å¤§å° */
      margin: 12px 0;
    }
  </style>
</head>
<body>
  <h2>ğŸ‘ ç¾Šäº†ä¸ªç¾Š Â· PC+æ‰‹æœºé€‚é…ç‰ˆ</h2>
  <div class="controls">
    <button onclick="initBoard()">é‡æ–°å¼€å§‹</button>
    <button onclick="undo()">æ’¤å›ä¸€æ­¥</button>
    <button onclick="shuffleRemain()">æ‰“ä¹±å‰©ä½™</button>
  </div>
  <div id="board"></div>
  <h3>æ§½ä½ (ä¸Šé™ 7)</h3>
  <div id="slot"></div>
  <p id="status"></p>

<script>
const TYPES = [
  "ğŸ‘","ğŸŒ¿","ğŸªµ","ğŸ’§","ğŸ”¥","â­",
  "ğŸ","ğŸŒ¸","ğŸ‹","ğŸ„","ğŸ¥•","ğŸ‡",
  "ğŸŒ","ğŸ¥¦","ğŸ“","ğŸ¥­"
];
const SLOT_LIMIT = 7;
let boardTiles = [];
let slot = [];
let history = [];

function generateDeck(total=96){
  let deck=[]; let chosen=[...TYPES]; let remain=total;
  chosen.forEach((type,i)=>{
    let count=3*(2+Math.floor(Math.random()*3));
    if(i===chosen.length-1) count=remain;
    if(count%3!==0) count+=(3-count%3);
    for(let j=0;j<count;j++) deck.push(type);
    remain-=count;
  });
  return shuffle(deck);
}

function initBoard(){
  const board=document.getElementById("board");
  board.innerHTML=""; boardTiles=[]; slot=[]; history=[];
  document.getElementById("status").textContent="";
  let deck=generateDeck(96); let id=0; let layers=4;
  for(let layer=0;layer<layers;layer++){
    let perLayer=Math.floor(deck.length/(layers-layer));
    for(let i=0;i<perLayer;i++){
      const type=deck.pop();
      const row=Math.floor(Math.random()*6);
      const col=Math.floor(Math.random()*8);
      boardTiles.push({id:id++,type,row,col,layer});
    }
  }
  renderBoard();
}

function renderBoard(){
  const board=document.getElementById("board");
  board.innerHTML="";
  boardTiles.forEach(tile=>{
    const el=document.createElement("div");
    el.className="tile layer"+tile.layer;
    el.textContent=tile.type;
    el.style.gridColumn = tile.col+1;
    el.style.gridRow = tile.row+1;
    if(isCovered(tile)){ el.classList.add("disabled"); }
    else { el.onclick=()=>pickTile(tile.id); }
    board.appendChild(el);
  });
  renderSlot();
}

function isCovered(tile){
  return boardTiles.some(t=>t.row===tile.row && t.col===tile.col && t.layer>tile.layer);
}

function pickTile(id){
  const idx=boardTiles.findIndex(t=>t.id===id);
  if(idx===-1) return;
  const tile=boardTiles[idx];
  if(isCovered(tile)) return;
  boardTiles.splice(idx,1);
  slot.push(tile);
  history.push({action:"pick",tile});
  checkTriple();
  if(slot.length>SLOT_LIMIT){
    document.getElementById("status").textContent="å¤±è´¥ï¼šæ§½ä½è¶…é™ï¼";
  }else if(boardTiles.length===0 && slot.length===0){
    document.getElementById("status").textContent="èƒœåˆ©ï¼";
  }
  renderBoard();
}

function renderSlot(){
  const slotEl=document.getElementById("slot");
  slotEl.innerHTML="";
  for(let i=0;i<SLOT_LIMIT;i++){
    const cell=document.createElement("div");
    cell.className="slot-cell";
    if(slot[i]) cell.textContent=slot[i].type;
    slotEl.appendChild(cell);
  }
}

function checkTriple(){
  const counts={};
  slot.forEach(c=>counts[c.type]=(counts[c.type]||0)+1);
  for(const type in counts){
    if(counts[type]>=3){ slot=slot.filter(c=>c.type!==type); }
  }
}

function undo(){
  if(history.length===0) return;
  const last=history.pop();
  if(last.action==="pick"){
    const sIdx=slot.findIndex(c=>c.id===last.tile.id);
    if(sIdx!==-1) slot.splice(sIdx,1);
    boardTiles.push(last.tile);
  }
  renderBoard();
}

function shuffleRemain(){
  boardTiles=shuffle(boardTiles);
  renderBoard();
}

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

initBoard();
</script>
</body>
</html>
